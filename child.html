<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Child Device</title>
    <style>
        body { font-family: sans-serif; text-align: center; background: #1a1a1a; color: white; padding-top: 50px; }
        button { padding: 15px 30px; font-size: 20px; cursor: pointer; background: #007bff; color: white; border: none; border-radius: 5px; }
        #status { margin-top: 20px; font-size: 18px; color: #ffcc00; }
    </style>
</head>
<body>

    <h2>Child Screen Sender</h2>
    <p>1. Click Button <br> 2. Select "Entire Screen" <br> 3. Click "Share"</p>
    
    <button onclick="startSharing()">START SHARING</button>
    
    <p id="status">Status: Disconnected</p>

    <video id="video" autoplay style="display:none;"></video>
    <canvas id="canvas" style="display:none;"></canvas>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        // Yahan tumhara Render URL dala hai connection ke liye
        const socket = io("https://parent-6j0g.onrender.com");

        socket.on("connect", () => {
            document.getElementById('status').innerText = "Status: Connected to Server";
            document.getElementById('status').style.color = "orange";
        });

        async function startSharing() {
            try {
                const stream = await navigator.mediaDevices.getDisplayMedia({
                    video: { cursor: "always" },
                    audio: false
                });

                const video = document.getElementById('video');
                video.srcObject = stream;
                
                document.getElementById('status').innerText = "Status: SHARING LIVE!";
                document.getElementById('status').style.color = "#00ff00";

                const canvas = document.getElementById('canvas');
                const context = canvas.getContext('2d');

                // Frame bhejne ka loop
                setInterval(() => {
                    if(video.readyState === video.HAVE_ENOUGH_DATA) {
                        // Quality settings (Speed badhane ke liye size half kiya)
                        canvas.width = video.videoWidth / 2; 
                        canvas.height = video.videoHeight / 2;
                        context.drawImage(video, 0, 0, canvas.width, canvas.height);
                        
                        // Image ko compress karke bhejo
                        const imageData = canvas.toDataURL("image/jpeg", 0.5);
                        socket.emit('screen-data', imageData);
                    }
                }, 100); // 100ms = 10 frames per second (smooth enough)

            } catch (err) {
                console.error("Error: " + err);
                alert("Permission Denied! Please allow screen share.");
            }
        }
    </script>
</body>
</html>
